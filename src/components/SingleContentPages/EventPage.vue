<template>
	<div id="event_page">
		<detail-page
			ref="eventWrapperPage"
			contentType="event"
			:isArchivedEvent="backendEndpoint == 'archived-events'"
			:id="event._id"
			:image="event.image ? event.image[2] : null"
			:imageSource="event.imageSource"
			:loading="loading"
			:submitStatus="submitStatus"
			v-on:edit="openDialog('editEventDialog')">
			<md-button slot="additonal-edit-buttons" class="md-icon-button edit-button" v-if="event.canceled != 2" v-on:click="openDialog('cancelDialog')">
				<md-icon>event_busy</md-icon>
				<md-tooltip md-direction="bottom">report event as cancelled</md-tooltip>
			</md-button>

			<div slot="important-information">
				<h1 v-if="event.canceled == 2" class="cancelled-info">
					<md-icon>warning</md-icon>
					<span>THIS EVENT WAS CANCELLED</span>
					<md-icon>warning</md-icon>
				</h1>

				<h3 v-if="event.canceled == 1 && $route.path.indexOf('/event/') != -1" class="unverified-cancelled-info">
					<md-icon>warning</md-icon>
					This event was reported as cancelled but the report is not verified yet! 
				</h3>
			</div>

			
			<h2 slot="title" class="title" v-if="event.name">{{event.name}}</h2>

			<div class="event-content">
				<div class="detail-info date">
					<div class="category">
						<svg width="50px" height="50px" viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve"><path d="M462,31h-44V10.25c0-5.521-4.49-10-10-10s-10,4.479-10,10V31h-81.5V10c0-5.521-4.49-10-10-10s-10,4.479-10,10v21h-81V10     c0-5.521-4.49-10-10-10s-10,4.479-10,10v21h-81.41V10.25c0-5.521-4.49-10-10-10c-5.52,0-10,4.479-10,10V31H50     C22.43,31,0,53.43,0,81v381c0,27.57,22.43,50,50,50h412c27.57,0,50-22.43,50-50V81C512,53.43,489.57,31,462,31z M492,462     c0,16.542-13.458,30-30,30H50c-16.542,0-30-13.458-30-30V202h472V462z M492,182H20v-20h472V182z M492,142H20V81     c0-16.542,13.458-30,30-30h44.09v19.25c0,5.51,4.48,10,10,10c5.51,0,10-4.49,10-10V51h81.41v19c0,5.51,4.49,10,10,10     s10-4.49,10-10V51h81v19c0,5.51,4.49,10,10,10s10-4.49,10-10V51H398v19.25c0,5.51,4.49,10,10,10s10-4.49,10-10V51h44     c16.542,0,30,13.458,30,30V142z" fill="#ff5252"/><path d="M408,100.25c-5.51,0-10,4.49-10,10s4.49,10,10,10s10-4.49,10-10S413.51,100.25,408,100.25z" fill="#ff5252"/><path d="M306.5,100c-5.51,0-10,4.49-10,10s4.49,10,10,10s10-4.49,10-10S312.01,100,306.5,100z" fill="#ff5252"/><path d="M205.5,100c-5.51,0-10,4.49-10,10s4.49,10,10,10s10-4.49,10-10S211.01,100,205.5,100z" fill="#ff5252"/><path d="M104.09,100.25c-5.52,0-10,4.49-10,10s4.48,10,10,10c5.51,0,10-4.49,10-10S109.6,100.25,104.09,100.25z" fill="#ff5252"/><path d="M167.221,418.208c8.971,8.589,22.116,12.88,39.445,12.88c16.405,0,29.706-4.14,39.905-12.42     c12.961-10.522,15.295-27.336,15.295-43.01c0-17.02-7.802-28.596-23.399-34.73c5.726-2.594,10.174-7.291,13.348-14.091     c3.173-6.796,4.762-14.777,4.762-23.941c0-27.542-16.255-41.317-48.76-41.317c-9.2,0-17.25,1.309-24.15,3.924     c-6.9,2.617-12.154,6.006-15.755,10.16c-3.604,4.158-6.25,8.431-7.936,12.814c-1.688,4.389-2.529,8.813-2.529,13.275     c0,5.035,0.956,8.428,2.875,10.182c1.915,1.754,6.095,2.631,12.535,2.631c9.505,0,14.26-3.813,14.26-11.439     c0-10.217,6.82-15.327,20.47-15.327c13.491,0,20.24,6.714,20.24,20.132c0,8.999-1.829,14.982-5.48,17.959     c-3.651,2.975-8.826,4.459-15.518,4.459c-5.938,0-8.902,3.91-8.902,11.73s2.911,11.73,8.74,11.73     c6.718,0,14.248,1.072,19.379,5.822c8.88,8.222,8.528,30.899,0.057,39.372c-3.909,3.91-10.159,5.865-18.744,5.865     c-7.36,0-13.189-1.495-17.48-4.485c-4.295-2.99-6.44-7.09-6.44-12.305c0-3.831-1.074-6.555-3.22-8.165     c-2.148-1.61-6.21-2.415-12.189-2.415c-5.215,0-8.895,0.845-11.04,2.529c-2.149,1.689-3.221,4.756-3.221,9.201     C153.766,399.963,158.251,409.623,167.221,418.208z" fill="#ff5252"/><path d="M293.145,306.889c2.146,0,3.986-0.69,5.521-2.07l7.36-7.36v122.819c0,2.915,1.455,5.215,4.369,6.9     c2.911,1.689,6.44,2.53,10.58,2.53c3.985,0,7.476-0.841,10.465-2.53c2.99-1.686,4.485-3.985,4.485-6.9v-149.5     c0-2.76-1.38-5.06-4.14-6.899s-5.829-2.76-9.2-2.76c-2.3,0-4.37,0.769-6.21,2.3l-27.14,20.7c-3.835,2.454-5.75,6.06-5.75,10.81     c0,3.069,0.92,5.829,2.76,8.28C288.085,305.662,290.385,306.889,293.145,306.889z" fill="#ff5252"/></svg>
						<h4>Date</h4>
					</div>
					<h4 class="category-content">{{event.formattedDate}}</h4>
				</div>

				<router-link :to="'/location/' + event.location.url">
					<div class="detail-info location" v-if="event.location">
							<div class="category">
								<svg width="50px" height="50px" viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve"><path d="M214.15,73.847c-57.789,0-104.803,47.015-104.803,104.803c0,57.789,47.015,104.804,104.803,104.804     c57.789,0,104.804-47.015,104.804-104.804S271.939,73.847,214.15,73.847z M214.15,263.454c-46.761,0-84.803-38.043-84.803-84.804     c0-46.761,38.042-84.803,84.803-84.803c46.761,0,84.804,38.042,84.804,84.803C298.954,225.411,260.911,263.454,214.15,263.454z" fill="#ff5252"/><path d="M125.153,90.081c2.39,0,4.788-0.852,6.701-2.58c22.593-20.412,51.819-31.654,82.296-31.654     c17.038,0,33.525,3.42,49.006,10.165c5.063,2.206,10.957-0.11,13.162-5.173c2.206-5.063-0.11-10.956-5.173-13.162     c-18.016-7.85-37.192-11.83-56.995-11.83c-35.44,0-69.428,13.074-95.704,36.814c-4.098,3.702-4.418,10.026-0.716,14.124     C119.704,88.97,122.423,90.081,125.153,90.081z" fill="#ff5252"/><path d="M101.143,108.146c-4.889-2.567-10.935-0.685-13.502,4.205c-10.659,20.3-16.293,43.226-16.293,66.299     c0,5.523,4.477,10,10,10s10-4.477,10-10c0-19.847,4.841-39.558,14-57.001C107.915,116.759,106.032,110.713,101.143,108.146z" fill="#ff5252"/><path d="M466.486,360.732c-0.012-0.436-0.044-0.892-0.114-1.324l-10-62c-0.782-4.846-4.964-8.408-9.873-8.408h-89.722     c23.905-47.183,36.022-84.27,36.022-110.35C392.8,80.142,312.658,0,214.15,0S35.5,80.142,35.5,178.65     c0,95.435,163.74,310.329,170.711,319.431c1.892,2.471,4.827,3.919,7.939,3.919s6.047-1.449,7.939-3.919     c0.275-0.359,23.494-30.74,52.411-73.167V490c0,5.523,4.477,10,10,10h172c5.523,0,10-4.477,10-10V361     C466.5,360.909,466.489,360.822,466.486,360.732z M437.984,309l6.774,42H296.242l6.774-42H437.984z M284.627,297.408l-10,62     c-0.084,0.519-0.127,1.066-0.127,1.592v27.973c-25.148,38.247-48.572,70.481-60.35,86.36     c-14.172-19.112-45.222-61.928-75.95-110.545C84.097,279.187,55.5,214.821,55.5,178.65C55.5,91.17,126.67,20,214.15,20     S372.8,91.17,372.8,178.65c0,24.519-12.964,61.638-38.522,110.35H294.5C289.592,289,285.409,292.562,284.627,297.408z M387.5,480     h-34v-68h34V480z M446.5,480h-39v-78c0-5.523-4.477-10-10-10h-54c-5.523,0-10,4.477-10,10v78h-39V371h152V480z" fill="#ff5252"/></svg>
								<h4>Location</h4>
							</div>
							<span class="category-content">
								<h4>{{event.location.name}}</h4>
								<p>{{event.location.address.street}}</p>
								<p>{{event.location.address.city}}</p>
								<p v-if="event.location.address.administrative || event.location.address.county">
									{{event.location.address.county ?event.location.address.county :''}}{{event.location.address.county && event.location.address.administrative ?', ' :''}}{{event.location.address.administrative ?event.location.address.administrative :''}}
								</p>
								<p>{{event.location.address.country}}</p>
							</span>
					</div>
				</router-link>

				<div class="detail-info line-up">
					<div class="category">
						<svg width="50px" height="50px" viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve"><path d="M327.777,161.1c1.16-5.399-2.277-10.716-7.677-11.876l-26-5.584c-5.402-1.162-10.717,2.277-11.876,7.677     c-1.16,5.399,2.277,10.716,7.677,11.876l26,5.584c0.707,0.152,1.413,0.225,2.109,0.225     C322.622,169.002,326.77,165.792,327.777,161.1z" fill="#ff5252"/><path d="M479.154,66.946L169.707,0.225c-2.954-0.638-6.038,0.096-8.39,1.995c-2.352,1.898-3.718,4.759-3.718,7.781v73.623     v189.012H96.277c-44.841,0-81.322,36.481-81.322,81.322s36.481,81.322,81.322,81.322s81.322-36.481,81.322-81.322V139.075     l77.301,16.602c0.708,0.152,1.414,0.225,2.109,0.225c4.612,0,8.76-3.21,9.767-7.902c1.16-5.399-2.277-10.717-7.677-11.876     l-81.5-17.504V96.01l289.446,62.408v180.938h-61.322c-44.841,0-81.322,36.481-81.322,81.322S360.882,502,405.723,502     s81.322-36.481,81.322-81.322V150.344h0.001V76.721C487.046,72.011,483.758,67.938,479.154,66.946z M157.599,353.957     c0,33.813-27.509,61.322-61.322,61.322c-33.813,0-61.322-27.509-61.322-61.322s27.509-61.322,61.322-61.322h61.322V353.957z      M177.599,75.55V22.386l289.446,62.409v53.164L177.599,75.55z M467.046,420.678c0,33.813-27.509,61.322-61.322,61.322     s-61.322-27.509-61.322-61.322s27.509-61.322,61.322-61.322h61.322V420.678z" fill="#ff5252"/><path d="M49,355.5c0,5.523,4.477,10,10,10s10-4.477,10-10c0-15.714,12.785-28.5,28.5-28.5c5.523,0,10-4.477,10-10     s-4.477-10-10-10C70.757,307,49,328.757,49,355.5z" fill="#ff5252"/><path d="M358.5,421.5c0,5.523,4.477,10,10,10s10-4.477,10-10c0-15.715,12.785-28.5,28.5-28.5c5.523,0,10-4.477,10-10     s-4.477-10-10-10C380.257,373,358.5,394.757,358.5,421.5z" fill="#ff5252"/></svg>
						<h4>Line-Up</h4>
					</div>
					<ul class="category-content">
						<li v-for="band of event.bands" :key="band._id"><router-link :to="`/band/${band.url}`"><span>{{band.name}}</span></router-link></li>
					</ul>
					<a v-if="event.ticketLink" class="ticket-link" :href="event.ticketLink" target="_blank">
						<svg width="35px" height="35px" viewBox="0 0 512.001 512"><path d="m131.21875 216.835938c2.632812 0 5.210938-1.070313 7.070312-2.929688 1.859376-1.863281 2.929688-4.441406 2.929688-7.070312 0-2.632813-1.070312-5.210938-2.929688-7.070313-1.859374-1.859375-4.4375-2.929687-7.070312-2.929687-2.640625 0-5.207031 1.070312-7.070312 2.929687-1.859376 1.859375-2.929688 4.4375-2.929688 7.070313 0 2.628906 1.070312 5.207031 2.929688 7.070312 1.863281 1.859375 4.441406 2.929688 7.070312 2.929688zm0 0" fill="#FAFAFA"/><path d="m274.46875 203.59375c-1.867188-1.859375-4.4375-2.929688-7.078125-2.929688-2.628906 0-5.210937 1.070313-7.070313 2.929688-1.859374 1.859375-2.929687 4.441406-2.929687 7.070312 0 2.628907 1.070313 5.210938 2.929687 7.070313 1.859376 1.859375 4.441407 2.929687 7.070313 2.929687 2.640625 0 5.210937-1.070312 7.078125-2.929687 1.859375-1.859375 2.921875-4.429687 2.921875-7.070313 0-2.628906-1.0625-5.210937-2.921875-7.070312zm0 0" fill="#FAFAFA"/><path d="m302.398438 185.664062c2.632812 0 5.210937-1.070312 7.070312-2.929687s2.921875-4.441406 2.921875-7.070313c0-2.628906-1.0625-5.210937-2.921875-7.070312s-4.4375-2.929688-7.070312-2.929688c-2.636719 0-5.21875 1.070313-7.078126 2.929688-1.859374 1.859375-2.929687 4.441406-2.929687 7.070312 0 2.628907 1.070313 5.210938 2.929687 7.070313 1.859376 1.859375 4.441407 2.929687 7.078126 2.929687zm0 0" fill="#FAFAFA"/><path d="m482 245.996094h-27.902344l49.117188-49.117188c5.664062-5.667968 8.785156-13.203125 8.785156-21.214844 0-8.011718-3.121094-15.546874-8.785156-21.210937l-44.550782-44.550781c-3.902343-3.902344-10.234374-3.902344-14.140624 0-5.664063 5.667968-13.199219 8.789062-21.210938 8.789062-8.015625 0-15.546875-3.121094-21.214844-8.789062-5.667968-5.664063-8.785156-13.199219-8.785156-21.210938 0-8.015625 3.121094-15.546875 8.785156-21.214844 1.875-1.875 2.929688-4.417968 2.929688-7.070312s-1.054688-5.195312-2.929688-7.070312l-44.546875-44.546876c-5.667969-5.667968-13.199219-8.789062-21.214843-8.789062-8.011719 0-15.546876 3.121094-21.210938 8.789062l-165.164062 165.160157c-3.90625 3.902343-3.90625 10.234375 0 14.140625s10.238281 3.90625 14.144531 0l165.160156-165.160156c1.890625-1.890626 4.398437-2.929688 7.070313-2.929688 2.671874 0 5.183593 1.039062 7.070312 2.929688l38.183594 38.179687c-5.386719 8.109375-8.277344 17.625-8.277344 27.582031 0 13.355469 5.199219 25.910156 14.644531 35.355469 9.445313 9.441406 22 14.644531 35.355469 14.644531 9.957031 0 19.46875-2.890625 27.582031-8.277344l38.179688 38.179688c3.898437 3.898438 3.898437 10.242188 0 14.140625l-63.261719 63.261719h-43.839844l32.855469-32.855469c3.902344-3.90625 3.902344-10.238281 0-14.140625l-101.824219-101.824219c-3.90625-3.90625-10.238281-3.90625-14.144531 0l-148.820313 148.820313h-120.039062c-16.542969 0-30 13.457031-30 30v63c0 5.519531 4.476562 10 10 10 16.542969 0 30 13.457031 30 30 0 16.539062-13.457031 30-30 30-5.523438 0-10 4.476562-10 10v63c0 16.539062 13.457031 30 30 30h452c16.542969 0 30-13.460938 30-30v-63c0-5.523438-4.476562-10-10-10-16.542969 0-30-13.460938-30-30 0-16.542969 13.457031-30 30-30 5.523438 0 10-4.480469 10-10v-63c0-16.542969-13.457031-30-30-30zm-176.070312-127.609375 87.683593 87.683593-39.925781 39.925782h-39.597656l29.316406-29.320313c3.90625-3.902343 3.90625-10.234375 0-14.140625-3.902344-3.90625-10.234375-3.90625-14.140625 0l-43.460937 43.457032h-107.480469zm186.070312 211.613281c-22.792969 4.644531-40 24.847656-40 48.996094 0 24.144531 17.207031 44.347656 40 48.996094v54.003906c0 5.511718-4.484375 10-10 10h-452c-5.515625 0-10-4.488282-10-10v-54.003906c22.792969-4.648438 40-24.851563 40-48.996094 0-24.148438-17.207031-44.347656-40-48.996094v-54.003906c0-5.515625 4.484375-10 10-10h452c5.515625 0 10 4.484375 10 10zm0 0" fill="#FAFAFA"/><path d="m213.570312 362.066406c1.859376-1.863281 2.929688-4.441406 2.929688-7.070312 0-2.632813-1.070312-5.210938-2.929688-7.070313-1.859374-1.859375-4.441406-2.929687-7.070312-2.929687s-5.210938 1.070312-7.070312 2.929687c-1.859376 1.859375-2.929688 4.4375-2.929688 7.070313 0 2.628906 1.070312 5.207031 2.929688 7.070312 1.859374 1.859375 4.441406 2.929688 7.070312 2.929688s5.210938-1.070313 7.070312-2.929688zm0 0" fill="#FAFAFA"/><path d="m312.570312 362.066406c1.859376-1.863281 2.929688-4.441406 2.929688-7.070312 0-2.632813-1.070312-5.210938-2.929688-7.070313-1.859374-1.859375-4.441406-2.929687-7.070312-2.929687s-5.210938 1.070312-7.070312 2.929687c-1.859376 1.859375-2.929688 4.4375-2.929688 7.070313 0 2.628906 1.070312 5.207031 2.929688 7.070312 1.859374 1.859375 4.441406 2.929688 7.070312 2.929688s5.210938-1.070313 7.070312-2.929688zm0 0" fill="#FAFAFA"/><path d="m263.070312 362.066406c1.859376-1.863281 2.929688-4.441406 2.929688-7.070312 0-2.632813-1.070312-5.210938-2.929688-7.070313-1.859374-1.859375-4.441406-2.929687-7.070312-2.929687s-5.210938 1.070312-7.070312 2.929687c-1.859376 1.859375-2.929688 4.4375-2.929688 7.070313 0 2.628906 1.070312 5.207031 2.929688 7.070312 1.859374 1.859375 4.441406 2.929688 7.070312 2.929688s5.210938-1.070313 7.070312-2.929688zm0 0" fill="#FAFAFA"/><path d="m157 364.996094c2.628906 0 5.210938-1.070313 7.070312-2.929688 1.859376-1.863281 2.929688-4.441406 2.929688-7.070312 0-2.632813-1.070312-5.210938-2.929688-7.070313-1.859374-1.859375-4.441406-2.929687-7.070312-2.929687s-5.210938 1.070312-7.070312 2.929687c-1.859376 1.859375-2.929688 4.4375-2.929688 7.070313 0 2.628906 1.070312 5.207031 2.929688 7.070312 1.859374 1.859375 4.441406 2.929688 7.070312 2.929688zm0 0" fill="#FAFAFA"/><path d="m362.070312 362.066406c1.859376-1.863281 2.929688-4.441406 2.929688-7.070312 0-2.632813-1.070312-5.210938-2.929688-7.070313-1.859374-1.859375-4.441406-2.929687-7.070312-2.929687s-5.210938 1.070312-7.070312 2.929687c-1.859376 1.859375-2.929688 4.4375-2.929688 7.070313 0 2.628906 1.070312 5.207031 2.929688 7.070312 1.859374 1.859375 4.441406 2.929688 7.070312 2.929688s5.210938-1.070313 7.070312-2.929688zm0 0" fill="#FAFAFA"/><path d="m157 412.996094h198c5.523438 0 10-4.480469 10-10 0-5.523438-4.476562-10-10-10h-198c-5.523438 0-10 4.476562-10 10 0 5.519531 4.476562 10 10 10zm0 0" fill="#FAFAFA"/><path d="m193.320312 440.996094c-2.628906 0-5.210937 1.070312-7.070312 2.929687s-2.929688 4.4375-2.929688 7.070313c0 2.628906 1.070313 5.207031 2.929688 7.070312 1.859375 1.859375 4.441406 2.929688 7.070312 2.929688 2.640626 0 5.210938-1.070313 7.070313-2.929688 1.871094-1.863281 2.929687-4.441406 2.929687-7.070312 0-2.632813-1.058593-5.210938-2.929687-7.070313-1.859375-1.859375-4.429687-2.929687-7.070313-2.929687zm0 0" fill="#FAFAFA"/><path d="m408 296.996094h-304c-5.523438 0-10 4.476562-10 10v144c0 5.519531 4.476562 10 10 10h41.65625c5.523438 0 10-4.480469 10-10 0-5.523438-4.476562-10-10-10h-31.65625v-124h284v124h-162.34375c-5.523438 0-10 4.476562-10 10 0 5.519531 4.476562 10 10 10h172.34375c5.523438 0 10-4.480469 10-10v-144c0-5.523438-4.476562-10-10-10zm0 0" fill="#FAFAFA"/></svg>
						<span>Tickets</span>
					</a>
				</div>

				<div class="detail-info description" v-if="event.description">
					<div class="category">
						<svg width="50px" height="50px" viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve"><path d="M133.928,149.771H115.73c2.738-20.265,13.942-21.282,19.098-21.752c5.15-0.469,9.094-4.787,9.094-9.959V88.135    c0-2.75-1.132-5.378-3.13-7.267c-1.999-1.889-4.681-2.864-7.432-2.717c-31.609,1.778-69.29,17.738-69.29,83.676v52.04    c0,8.687,7.067,15.754,15.755,15.754h54.103c8.687,0,15.754-7.067,15.754-15.754v-48.342    C149.682,156.838,142.615,149.771,133.928,149.771z M129.681,209.62H84.07v-47.794c0-46.01,20.461-58.859,39.852-62.487v10.515    c-13.392,4.076-28.804,16.113-28.804,49.915c0,5.523,4.478,10,10,10h24.563V209.62z" fill="#ff5252"/><path d="M444.774,255.997h-48.692c-8.369,0-15.179,6.809-15.179,15.179v43.508c0,8.37,6.81,15.179,15.179,15.179h15.237    c-2.546,16.341-11.485,17.155-16.139,17.579c-5.15,0.469-9.094,4.787-9.094,9.959v26.933c0,2.75,1.132,5.378,3.131,7.267    c1.861,1.76,4.321,2.733,6.869,2.733c0.187,0,0.374-0.005,0.562-0.016c28.879-1.625,63.305-16.182,63.305-76.307v-46.835    C459.953,262.806,453.143,255.997,444.774,255.997z M439.953,318.011c0,39.702-17.161,51.483-33.866,55.011v-7.494h-0.001    c12.207-3.952,25.923-15.179,25.923-45.665c0-5.523-4.478-10-10-10h-21.106v-33.866h39.05V318.011z" fill="#ff5252"/><path d="M351.919,255.997h-48.692c-8.37,0-15.179,6.809-15.179,15.179v43.508c0,8.37,6.81,15.179,15.179,15.179h15.238    c-2.545,16.34-11.484,17.155-16.139,17.579c-5.15,0.469-9.094,4.787-9.094,9.959v26.933c0,2.75,1.132,5.378,3.13,7.267    c1.862,1.76,4.322,2.733,6.87,2.733c0.187,0,0.374-0.005,0.562-0.016c28.879-1.625,63.304-16.182,63.304-76.307v-46.835    C367.098,262.806,360.288,255.997,351.919,255.997z M347.098,318.011c0,39.702-17.16,51.483-33.865,55.011v-7.495    c12.207-3.953,25.923-15.18,25.923-45.665c0-5.523-4.478-10-10-10h-21.107v-33.865h39.049V318.011z" fill="#ff5252"/><path d="M452.333,190.499h-31.906c-5.522,0-10,4.477-10,10s4.478,10,10,10h31.906c21.872,0,39.667,17.794,39.667,39.667v148.667    c0,21.872-17.795,39.667-39.667,39.667h-77c-2.652,0-5.195,1.054-7.071,2.929l-35.929,35.929v-28.859c0-5.523-4.478-10-10-10    h-26.666c-21.872,0-39.667-17.794-39.667-39.667V250.165c0-21.872,17.795-39.667,39.667-39.667H333c5.522,0,10-4.477,10-10    c0-5.523-4.478-10-10-10h-37.333c-17.272,0-32.845,7.384-43.751,19.152v-44.128c0-8.687-7.067-15.754-15.754-15.754h-18.197    c2.737-20.263,13.941-21.281,19.098-21.75c5.15-0.469,9.094-4.787,9.094-9.959V88.135c0-2.75-1.132-5.378-3.13-7.267    c-1.999-1.889-4.692-2.867-7.432-2.717c-31.61,1.778-69.29,17.739-69.29,83.676v52.04c0,8.687,7.067,15.754,15.755,15.754h54.103    c1.262,0,2.484-0.165,3.661-0.447c-2.465,6.534-3.823,13.606-3.823,20.992v148.667c0,32.9,26.767,59.667,59.667,59.667h16.666v43    c0,4.044,2.437,7.691,6.173,9.239c1.237,0.513,2.537,0.762,3.825,0.762c2.603,0,5.16-1.017,7.073-2.929l50.071-50.071h72.857    c32.9,0,59.667-26.766,59.667-59.667V250.165C512,217.265,485.233,190.499,452.333,190.499z M231.916,209.62h-45.611v-47.794    c0-46.009,20.461-58.859,39.852-62.487v10.516c-13.392,4.075-28.804,16.112-28.804,49.914c0,5.523,4.478,10,10,10h24.563V209.62z" fill="#ff5252"/><path d="M386.069,193.429c-1.859-1.86-4.439-2.93-7.069-2.93s-5.21,1.07-7.07,2.93c-1.86,1.86-2.93,4.44-2.93,7.07    s1.069,5.21,2.93,7.07c1.861,1.86,4.44,2.93,7.07,2.93s5.21-1.07,7.069-2.93c1.86-1.86,2.931-4.44,2.931-7.07    S387.93,195.289,386.069,193.429z" fill="#ff5252"/><path d="M313.069,158.099c-1.859-1.87-4.429-2.93-7.069-2.93c-2.63,0-5.21,1.06-7.07,2.93c-1.86,1.85-2.93,4.43-2.93,7.07    c0,2.63,1.069,5.21,2.93,7.07c1.861,1.86,4.44,2.93,7.07,2.93c2.64,0,5.21-1.07,7.069-2.93c1.86-1.86,2.931-4.44,2.931-7.07    C316,162.529,314.93,159.949,313.069,158.099z" fill="#ff5252"/><path d="M248.573,0.499H67.427C30.247,0.499,0,30.746,0,67.926v171.896c0,37.18,30.247,67.427,67.427,67.427h21.118l58.353,58.352    c1.913,1.914,4.471,2.93,7.073,2.93c1.288,0,2.588-0.25,3.825-0.762c3.736-1.548,6.173-5.194,6.173-9.239v-51.281H199    c5.522,0,10-4.477,10-10s-4.478-10-10-10h-45.031c-5.522,0-10,4.477-10,10v37.139l-44.21-44.21    c-1.876-1.875-4.419-2.929-7.071-2.929H67.427C41.275,287.249,20,265.973,20,239.822V67.926c0-26.151,21.275-47.427,47.427-47.427    h181.146c26.152,0,47.427,21.276,47.427,47.427v59.239c0,5.523,4.478,10,10,10c5.522,0,10-4.477,10-10V67.926    C316,30.746,285.753,0.499,248.573,0.499z" fill="#ff5252"/></svg>
						<h4>Description</h4>
					</div>
					<div class="category-content">
						<p>{{event.description}}</p>
					</div>
				</div>
			</div>
			
			<div slot="edit-dialogs">
				<md-dialog ref="editEventDialog">
					<event-form 
						:event="JSON.parse(JSON.stringify(event))" 
						v-model="eventImage" 
						edit 
						canSubmit 
						v-on:submit="updateEvent" 
						v-on:close="$refs.editEventDialog.close()">
						<h1 slot="headline">Edit Event</h1>
					</event-form>
				</md-dialog>

				<md-dialog ref="cancelDialog">
					<div class="cancel-dialog">
						<h2>Do you really want to report this event as cancelled?</h2>
						<md-icon class="yes-icon">check</md-icon>
						<md-icon class="no-icon">clear</md-icon>
						<md-button class="yes" v-on:click="reportCancel(true)">Yes</md-button>
						<md-button class="no" v-on:click="reportCancel(false)">No</md-button>
					</div>
				</md-dialog>
			</div>
		</detail-page>
	</div>
</template>

<script>
import { removeEmptyObjectFields, addBandLabels } from '@/helpers/array-object-helpers.js';

import EventForm from '@/components/ContentForms/EventForm';
import DetailPage from '@/components/SingleContentPages/DetailPage';

import { backendUrl, imageUrl } from '@/secrets.js';
import moment from 'moment';

export default {
	name: 'event-page-new',
	components: {
		EventForm,
		DetailPage
	},
	watch: {
		$route() {
			if(this.$route.params.url != this.event.url)
				this.getEventByUrl();
		},
		eventImage() {
			this.$refs.eventWrapperPage.updateImageUrl(this.event);
		}
	},
	computed: {
		event() {
			return JSON.parse(JSON.stringify(this.$store.getters.currentEvent));
		}
	},
	data() {
		return {
			submitStatus: '',
			isAuthenticated: false,
			backendEndpoint: 'events',
			loading: false, 
			eventImage: '',
			previousImage: ''
		}
	},
	methods: {
		openDialog(ref) {
			this.$refs[ref].open();
		},
		updateEvent(data) {
			this.$refs.editEventDialog.close();
		
			this.loading = true;

			removeEmptyObjectFields(data);
			data.date = moment(data.date).format('YYYY-MM-DD');

			
			let formData = new FormData();
			if(this.eventImage != this.previousImage) {
				if(this.eventImage != null) formData.append('image', this.eventImage);
				else this.event.image = [];
			}
			formData.append('data', JSON.stringify(data));

			this.$http.put(backendUrl + `/api/events/${data._id}`, formData)
				.then(response => {
					this.getCurrentEvent('Event successfully updated!');
				})
				.catch(err =>  {
					this.submitStatus = err.body.message;
					this.$children[0].$refs.snackbar.open();
				});
		},
		getCurrentEvent(message = '') {
			this.loading = true;

			this.$http.get(backendUrl + `/api/events/byid/` + this.event._id)
				.then(response => {
					this.loading = false;
					if(response.body.data) {
						if(message != '') {
							this.submitStatus = message;
							this.$children[0].$refs.snackbar.open();
						}

						this.$store.commit('setCurrentEvent', response.body.data);
						addBandLabels(this.event);
						this.$router.push({path: `/event/${response.body.data.url}`});
						document.title = `${this.event.name}, ${moment(this.event.date).format('DD.MM.YYYY')}, ${this.event.location.name} | AWAY FROM LIFE STREETS`;
					}
				})
				.catch(err => {
					this.loading = false;
					this.submitStatus = err.body.message;
					this.$children[0].$refs.snackbar.open();
				});
		},
		reportCancel(accept) {
			document.getElementsByClassName(accept ?'yes' :'no')[0].classList.add('selected');
			document.getElementsByClassName(accept ?'yes-icon' :'no-icon')[0].classList.add('selected');
			setTimeout(() => {
				if(accept) {
					this.$http.put(backendUrl + `/api/${this.backendEndpoint}/cancel/${this.event._id}`)
					.then(response => {
						this.$refs.cancelDialog.close();
						this.submitStatus = 'Thanks for your report, we will verify it before it is visible for everyone!';
						this.$children[0].$refs.snackbar.open();
					})
					.catch(err => {
						this.$refs.cancelDialog.close();
						this.submitStatus = err.body.message;
						this.$children[0].$refs.snackbar.open();
					})
				}

				this.similarEventFound = false;
				setTimeout(() => {
					this.$refs.cancelDialog.close();
					setTimeout(() => {
						document.getElementsByClassName(accept ?'yes' :'no')[0].classList.remove('selected');
						document.getElementsByClassName(accept ?'yes-icon' :'no-icon')[0].classList.remove('selected');
					}, 200);
				},200);
			}, 500);
		},
		getEventByUrl() {
			this.loading = true;

			this.$http.get(backendUrl + `/api/${this.backendEndpoint}/byurl/` + this.$route.params.url)
			.then(response => {
				if(response.body.data) {					
					this.loading = false;
					this.$store.commit('setCurrentEvent', response.body.data);
					this.previousImage = `${imageUrl}/${this.event.image[2]}`;
					this.eventImage = `${imageUrl}/${this.event.image[2]}`;
					document.title = `${this.event.name}, ${moment(this.event.date).format('DD.MM.YYYY')}, ${this.event.location.name} | AWAY FROM LIFE STREETS`;
				}
			})
			.catch(err => this.$router.push('/not-found'));
		}
	},
	mounted() {
		if(this.$route.path.indexOf('event') != -1)
			document.getElementById('topbar').classList.add('single-page');

		let urlDate = moment(this.$route.path.split('--')[1], 'DD-MM-YYYY', true);

		if(urlDate.isValid() && moment(urlDate).isBefore(moment(), 'day'))
			this.backendEndpoint = 'archived-events';
		
		
		this.$http.get(backendUrl + '/api/users/auth')
			.then(response => {
				this.isAuthenticated = true;
			})
			.catch(err => console.log(err));
			
		if(this.$store.getters.currentEvent.name == '' || (this.$store.getters.currentEvent.url != this.$route.params.url && this.$route.path.indexOf('/event') != -1))
			this.getEventByUrl();
		else {
			//THIS DEFINITELY NEEDS A NICER FIX
			document.title = `${this.event.name}, ${moment(this.event.date).format('DD.MM.YYYY')}, ${this.event.location.name} | AWAY FROM LIFE STREETS`;
			this.previousImage = `${imageUrl}/${this.event.image[2]}`;
			this.eventImage = `${imageUrl}/${this.event.image[2]}`;
			// document.getElementsByClassName('image')[0].style.backgroundImage = `url(${imageUrl}/${this.event.image[2]})`;
		}
			
	},
}
</script>

<style lang="scss">
	@import "src/scss/SingleContentPages/_eventPage.scss";
</style>